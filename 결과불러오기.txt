import requests
import json

API_KEY = "AIzaSyAgCWPZsdNl5b2ob1cIh7IQ_aHFfjUjrcs"  # Google Cloud Platform에서 발급받은 API 키를 입력하세요.
CX = "e4dcfdc9ce2654b5a"     # casenote.kr용으로 생성한 검색 엔진 ID를 입력하세요.

def search_casenote(query, num_results=5):
    """
    casenote.kr에서 Google Custom Search API를 이용해 상위 num_results개의 판례를 검색합니다.
    """
    url = "https://www.googleapis.com/customsearch/v1"
    params = {
        "key": API_KEY,
        "cx": CX,
        "q": query,
        "num": num_results
    }

    try:
        response = requests.get(url, params=params)
        response.raise_for_status()
        data = response.json()

        results = []
        if "items" in data:
            for item in data["items"]:
                title = item.get("title", "제목 없음")
                link = item.get("link", "링크 없음")
                snippet = item.get("snippet", "내용 일부 없음")
                results.append({"title": title, "link": link, "snippet": snippet})
        
        return results
    
    except requests.exceptions.RequestException as e:
        print(f"네트워크 오류가 발생했습니다: {e}")
        return []
    except json.JSONDecodeError as e:
        print(f"JSON 응답을 파싱하는 중 오류가 발생했습니다: {e}")
        return []

if __name__ == "__main__":
    search_query = input("검색할 판례 키워드를 입력하세요: ")
    search_results = search_casenote(search_query, num_results=5)

    if search_results:
        print("\n--- 상위 5개 검색 결과 ---")
        for i, result in enumerate(search_results, 1):
            print(f"\n[{i}] 제목: {result['title']}")
            print(f"    URL: {result['link']}")
            
            # 내용을 여러 줄로 나누어 출력
            print("    내용:")
            # 마침표, 물음표, 느낌표를 기준으로 문장을 나눔
            sentences = result['snippet'].replace('. ', '.\n').replace('? ', '?\n').replace('! ', '!\n').split('\n')
            for sentence in sentences:
                if sentence:  # 빈 줄은 건너뜁니다.
                    print(f"        {sentence.strip()}")
            
            print("-" * 50)
    else:
        print("검색 결과를 찾을 수 없거나 오류가 발생했습니다.")